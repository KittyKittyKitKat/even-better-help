<!doctype html>
<html lang="en">

<head>
    <title>Calendar</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!--Personalized CSS buttons-->
    <link rel="stylesheet" href="styles/calendar.css">

</head>

<body>
    <!--Day pop-up -->
    <!--Modal-->
    <!-- Modal -->
    <form>
        <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
            aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="staticBackdropLabel">Today's Journal</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="form-floating">
                        <textarea class="form-control" placeholder="Write today's journal entry here."
                            id="journal_entry"></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Submit</button>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <!--End of Modal-->

    <div class="mt-5 pt-5 text-center" id="grid-anchor" style="max-width: 60%; margin: auto;">
        <H2 class="fs-1 fw-bold text-left" id="year_entry">Year</H2>
        <H2 class="fs-1 fw-bold text-left" id="month_entry">Month</H2>
    </div>

    <!-- Bootstrap JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous">
        </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.min.js"
        integrity="sha384-7VPbUDkoPSGFnVtYi0QogXtr74QeVeeIs99Qfg5YCF+TidwNdjvaKZX19NZ/e6oz" crossorigin="anonymous">
        </script>

    <script>
        //TO-DO: move globals up here
        const month_arr = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        const month_len = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

        // run functions
        update_dates();
        generate_grid();


        function generate_grid() {
            let days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
            let header = document.createElement("div");
            header.classList.add("row");
            for (let i = 0; i < 7; i++) {
                let header_col = document.createElement("div");
                header_col.classList.add("col", "grid-fix", "px-1");
                header_col.innerHTML = days[i];
                header.appendChild(header_col);
            }
            //TO-DO: clean this up

            let count = 0;
            let id = 0;
            let dummy = false;

            document.getElementById("grid-anchor").appendChild(header)
            for (let i = 0; i < 5; i++) { // need five rows to contain all possible days
                let new_row = document.createElement("div");
                new_row.classList.add("row");
                for (let j = 0; j < 7; j++) { // need seven days per week (duh)
                    let new_col = document.createElement("div");
                    new_col.classList.add("col", "grid-fix", "px-1");
                    if (count >= window.start_day && count < window.last_day + window.start_day) {
                        dummy = false;
                        id++;
                    } else {
                        dummy = true;
                    }
                    const day1 = "hello hewoo this is my day 1 and this should be extracted from a json";

                    count++;
                    btn = generate_day(new_col, id, dummy);
                    new_col.appendChild(btn);
                    new_row.appendChild(new_col);
                }
                document.getElementById("grid-anchor").appendChild(new_row);
            }
        }

        function update_dates() {
            let date = new Date();
            window.year = date.getFullYear();
            window.month = date.getMonth();
            document.getElementById("month_entry").innerHTML = month_arr[window.month];
            document.getElementById("year_entry").innerHTML = window.year;
            let start_date = new Date(window.year, window.month, 1);
            window.start_day = start_date.getDay();
            window.last_day = month_len[window.month];

        }

        function generate_day(col, id, dummy) {
            let btn = document.createElement("button");
            btn.classList.add("btn", "btn-dark", "my-1", "btn-day", "btn-circle");
            btn.innerHTML = id;
            btn.setAttribute("data-bs-target", "#staticBackdrop");
            btn.setAttribute("data-bs-toggle", "modal");
            btn.addEventListener("click", () => {
                update_day(id);
            });
            btn.id = id - 1;
            if (dummy) {
                btn.disabled = true
                btn.innerHTML = ":3";
            }

            return btn;
        }

        function update_day(id) {
            console.log(entry_arr[id]);
            document.getElementById("journal_entry").value = entry_arr[id];
        }

    </script>

    <style>
        .month-txt {
            font: optional;
        }

        .grid-fix {
            flex-grow: 0;
        }
    </style>

</body>

</html>